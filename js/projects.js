// *** projects *******************
oss_projects = {};

// Side Projects
oss_projects['MahoMangaDownloader'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/MahoMangaDownloader',
  featured: true,
  position: 1,
  background: 'MahoMangaDownloader_885x450.jpg',
  msg: '下載漫畫的小工具喔~'
};
oss_projects['Norn-StockScreener'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/Norn-StockScreener',
  online_website: 'https://norn-stockscreener.zmcx16.moe/',
  android: 'https://play.google.com/store/apps/details?id=moe.zmcx16.norn_stockscreener',
  featured: true,
  position: 2,
  background: 'norn-stockscreener_885x450.png',
  msg: '君のような女神に ずっとそばにいてほしい'
};
oss_projects['AxisTradeCult'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/AxisTradeCult',
  featured: true,
  position: 3,
  background: 'AxisTradeCult_885x450.jpg',
  msg: '聽說Qt很可怕, 是真的嗎?'
};
oss_projects['MangaPrettier'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/MangaPrettier',
  featured: true,
  position: 4,
  background: 'MangaPrettier_885x450.jpg',
  msg: '聽說科學研究指出看漫畫有益身心健康喔~'
};
oss_projects['AxisCult'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/%E9%98%BF%E5%85%8B%E8%A5%BF%E6%96%AF%E6%95%99%E5%82%B3%E6%95%99%E7%B6%B2%E7%AB%99',
  online_website: 'http://axiscult.zmcx16.moe/',
  featured: true,
  position: 5,
  background: 'mosaicAqua_885x450.jpg',
  msg: '阿克西斯教! 快加入阿克西斯教喔!!!'
};
oss_projects['ReclassifyAnimeCG'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/ReclassifyAnimeCG',
  featured: true,
  position: 6,
  background: 'ReclassifyAnimeCG_885x450.png',
  msg: '用PyTorch幫忙分類CG吧!!'
};
oss_projects['PhotoMosaic-Artifact'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/PhotoMosaic-Artifact',
  featured: true,
  position: 7,
  background: 'PhotoMosaic-Artifact_885x450.jpg',
  msg: 'Photo Mosaic Artifact...中二病?'
};
oss_projects['Norn-Finance-API-Server'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/Norn-Finance-API-Server',
  online_website: 'https://norn-stockscreener.zmcx16.moe/options/',
  featured: true,
  position: 8,
  background: 'Norn-Finance-API-Server_885x450.png',
  msg: '選擇權估值模型...好深奧...'
};
oss_projects['Norn-Finance-Backtesting'] = {
  blog_post: 'https://github.com/zmcx16/Norn-Finance-Backtesting',
  featured: true,
  position: 9,
  background: 'Norn-Finance-Backtesting_885x450.png',
  msg: 'スカイクラッドの観測者'
};
oss_projects['leetcode-solver-bot-verify-tool'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/leetcode-solver-bot-verify-tool',
  featured: true,
  position: 10,
  background: 'leetcode-solver-bot-verify-tool_885x450.png',
  msg: 'LeetCode Solver Bot & Verify Tool'
};
oss_projects['stock-forecast'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/stock-forecast',
  featured: true,
  position: 11,
  background: 'stock-forecast_885x450.png',
  msg: 'エンディングが、見えた'
};
oss_projects['TW-Stock Lottery Secretary'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/FB%E7%B2%89%E7%B5%B2%E5%B0%88%E9%A0%81%E6%A9%9F%E5%99%A8%E4%BA%BA%E9%96%8B%E7%99%BC%20-%20%E8%82%A1%E7%A5%A8%E6%8A%BD%E7%B1%A4%E5%B0%8F%E7%A7%98%E6%9B%B8',
  featured: true,
  position: 12,
  background: 'TWStockLotterySecretary_885x450.jpg',
  msg: '歡迎加入追蹤+訂閱喔~'
};
oss_projects['twitter-images-collector'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/twitter-images-collector',
  featured: true,
  position: 13,
  background: 'twitter-images-collector_885x450.png',
  msg: '追蹤&同步下載推特用戶圖片'
};
oss_projects['OpenAI-Gym-Hearts'] = {
  featured: true,
  position: 14,
  background: 'OpenAI-Gym-Hearts_885x450.jpg',
  msg: '要一起玩牌嗎?'
};
oss_projects['stock-minehunter'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/norn-minehunter%E7%B6%B2%E7%AB%99%E9%96%8B%E7%99%BC',
  online_website: 'https://norn-minehunter.zmcx16.moe/',
  featured: true,
  position: 15,
  background: 'stock-minehunter_885x450.jpg',
  msg: 'Explosion!!!'
};
oss_projects['AuctionKira'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/AuctionKira',
  featured: true,
  position: 16,
  background: 'AuctionKira_885x450.png',
  msg: '(<ゝω·)☆KIRA！'
};
oss_projects['ChaldeaStockObservatory'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/ChaldeaStockObservatory',
  featured: true,
  position: 17,
  background: 'ChaldeaStockObservatory_885x450.jpg',
  msg: '斯大可...是什麼啊?'
};
oss_projects['find-house-assistant-chrome-extension'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/%E5%9C%A8%E5%8F%B0%E7%81%A3%E8%B2%B7%E6%88%BF%E5%AD%90%E6%98%AF%E4%B8%8D%E6%98%AF%E6%90%9E%E9%8C%AF%E4%BA%86%E4%BB%80%E9%BA%BC',
  featured: true,
  position: 18,
  background: 'find-house-assistant-chrome-extension_885x450.jpg',
  msg: '在台灣買房子是不是搞錯了什麼...'
};
oss_projects['protobuf-deserializer'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/protobuf-deserializer%E7%B6%B2%E7%AB%99%E9%96%8B%E7%99%BC',
  online_website: 'https://protobuf-deserializer.zmcx16.moe',
  featured: true,
  position: 19,
  background: 'protobuf-deserializer_885x450.jpg',
  msg: '好像很厲害?'
};
oss_projects['MemoOffVocabulary'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/MemoOffVocabulary',
  featured: true,
  position: 20,
  background: 'MemoOffVocabulary_885x450.jpg',
  msg: '要好好念書喔~'
};
oss_projects['zmcx16.github.io'] = {
  blog_post: 'https://blog.zmcx16.moe/search/label/%E5%80%8B%E4%BA%BA%E7%B6%B2%E7%AB%99%E9%96%8B%E7%99%BC',
  online_website: 'https://project.zmcx16.moe',
  featured: true,
  position: 21,
  background: 'zmcx16.github.io_885x450.jpg',
  msg: 'いらっしゃいませ~~~'
};
oss_projects['OpenAI-Gym-GongZhu'] = {
  featured: true,
  position: 22,
  background: 'OpenAI-Gym-GongZhu_885x450.jpg',
  msg: '要一起玩牌嗎?'
};
oss_projects['Misc'] = {
  featured: true,
  position: 23,
  background: 'Misc_885x450.jpg',
  msg: '聽說是某個大哥哥的黑歷史?'
};

// Starred
oss_projects['electronjs.org'] = {
  subject: 'Application_Framework'
};

oss_projects['self-driving-car'] = {
  subject: 'AI_ML'
};

oss_projects['pytrader'] = {
  subject: 'Trade'
};
oss_projects['pyti'] = {
  subject: 'Trade'
};
oss_projects['Deep-Trading'] = {
  subject: 'Trade'
};
oss_projects['deep_trader'] = {
  subject: 'Trade'
};
oss_projects['MachineLearningStocks'] = {
  subject: 'Trade'
};
oss_projects['StockPricePrediction'] = {
  subject: 'Trade'
};

// ********************************
// *** orgs ***********************
Organization = function (name, repos) {
  this.name = name;
  this.repos = repos || [];
}

Organization.prototype.totalForks = function () {
  total = 0;
  this.repos.forEach(function (repo) {
    total += repo.forks;
  });

  return total;
}

Organization.prototype.totalWatchers = function () {
  total = 0;
  this.repos.forEach(function (repo) {
    total += repo.watchers;
  });

  return total;
}

Organization.prototype.forkedCount = function () {
  total = 0;
  this.repos.forEach(function (repo) {
    if (repo.fork) {
      total += 1;
    }
  });

  return total;
}

Organization.prototype.notForkedCount = function () {
  total = 0;
  this.repos.forEach(function (repo) {
    if (!repo.fork) {
      total += 1;
    }
  });

  return total;
}

Organization.prototype.featuredRepos = function () {
  featured = [];
  this.repos.forEach(function (repo) {
    if (repo.featured() && !repo.fork && repo.in_project_list()) {
      if (repo.position()) {
        featured[repo.position() - 1] = repo
      } else {
        featured.push(repo);
      }
    }
  });

  return featured;
}

Organization.prototype.deprecatedRepos = function () {
  deprecated = [];
  this.repos.forEach(function (repo) {
    if (repo.deprecated() && !repo.fork) {
      deprecated.push(repo);
    }
  });

  return deprecated;
}


Organization.prototype.forkedRepos = function () {
  forked = [];
  this.repos.forEach(function (repo) {
    if (repo.fork) {
      forked.push(repo);
    }
  });

  return forked;
}

Organization.prototype.regularRepos = function (subject) {
  regular = [];
  this.repos.forEach(function (repo) {
    if (!repo.fork && !repo.featured() && !repo.deprecated() && repo.in_project_list() && repo.subject() == subject) {
      regular.push(repo);
    }
  });

  return regular;
}

Organization.prototype.addReposToContainer = function (container, repos) {
  repos.forEach(function (repo, i) {
    container.append(repo.getContainer(i + 1));
  });
}
// ********************************

// *** repos **********************
Repository = function (repo) {
  // attributes
  this.name = repo.name;
  this.language = repo.language;
  this.url = repo.html_url;
  this.description = repo.description;
  this.fork = repo.fork;
  this.watchers = repo.watchers;
  this.forks = repo.forks;

  //only for virtual container
  this.new_tab = repo.new_tab;
  this.on_click = repo.on_click;
}

Repository.prototype.in_project_list = function () {
  return oss_projects[this.name];
}

Repository.prototype.subject = function () {
  if (oss_projects[this.name] && oss_projects[this.name].subject) {
    return oss_projects[this.name].subject;
  }
}

Repository.prototype.blogPost = function () {
  if (oss_projects[this.name] && oss_projects[this.name].blog_post) {
    return oss_projects[this.name].blog_post;
  }
}

Repository.prototype.onlineWebsite = function () {
  if (oss_projects[this.name] && oss_projects[this.name].online_website) {
    return oss_projects[this.name].online_website;
  }
}

Repository.prototype.android = function () {
  if (oss_projects[this.name] && oss_projects[this.name].android) {
    return oss_projects[this.name].android;
  }
}

Repository.prototype.msg = function () {
  if (oss_projects[this.name] && oss_projects[this.name].msg) {
    return oss_projects[this.name].msg;
  }
}

Repository.prototype.featured = function () {
  return oss_projects[this.name] && oss_projects[this.name].featured;
}

Repository.prototype.deprecated = function () {
  return oss_projects[this.name] && oss_projects[this.name].deprecated;
}

Repository.prototype.position = function () {
  if (oss_projects[this.name] && oss_projects[this.name].position) {
    return oss_projects[this.name].position;
  }
}

Repository.prototype.logo = function () {
  if (oss_projects[this.name] && oss_projects[this.name].logo) {
    return oss_projects[this.name].logo;
  }
}

Repository.prototype.background = function () {
  if (oss_projects[this.name] && oss_projects[this.name].background) {
    return oss_projects[this.name].background;
  }
}

Repository.prototype.classes = function () {
  if (this.featured()) {
    return 'featured-project';
  } else if (this.deprecated()) {
    return 'deprecated-project';
  }
}

Repository.prototype.getBlogLink = function () {
  if (this.blogPost()) {
    return '<a href="' + this.blogPost() + '" target="_blank" class="blog-post"><span class="octicon octicon-file-text"></span>&nbsp&nbspBlog</a> ';
  }
}

Repository.prototype.getWebsiteLink = function () {
  if (this.onlineWebsite()) {
    return '<a href="' + this.onlineWebsite() + '" target="_blank" class="online-website"><span class="octicon octicon-global-text"></span>&nbsp&nbspWebsite</a> ';
  }
}

Repository.prototype.getAndroidLink = function () {
  if (this.android()) {
    return '<a href="' + this.android() + '" target="_blank" class="android"><span class="octicon octicon-android-text"></span>&nbsp&nbspAndroid</a> ';
  }
}

Repository.prototype.getContainer = function (index) {
  var last = '';
  if (!this.featured() && index % 4 == 0) {
    last = 'last-in-row'
  }

  var msg = '';
  if (this.msg()) {
    msg = 'msg="' + this.msg() + '"';
  }

  return [
    '<div class="project island-light island-stack island ', this.language, ' ', this.classes(), ' ', last, '" ' + msg +'>',
    this.featuredImage(),
    this.repoContent(),
    this.bottomLinks(),
    '</div>'
  ].join('');
}

Repository.prototype.featuredImage = function () {
  if (this.featured()) {
    return [
      '<div class="island-item featured-image">',
      '<img src="/img/', this.background(), '">',
      '</div>'
    ].join('');
  }
}

Repository.prototype.headerLogo = function () {
  if (this.logo()) {
    return '<img src="/img/' + this.logo() + '" height="21px" width="26px" class="logo"> ';
  }
}

Repository.prototype.repoContent = function () {

  var tab = " target=\"_blank\"";
  if (typeof this.new_tab !== 'undefined' && !this.new_tab) {
    tab = " ";
  }

  var on_click = "";

  var vhref = ' vhref="' + this.url + '"';
  if (this.on_click) {
    on_click = " onclick='" + this.on_click + "'";
    vhref = ' ';
  }

  return [
    '<div class="island-item content">',
    '<h3>',
    '<a ', vhref, tab, on_click, '>', this.headerLogo(), this.name, '</a>',
    '</h3>',
    '<div class="repo-info">',
    '<span><i class="octicon octicon-star"></i> ', this.watchers, '</span> ',
    '<span><i class="octicon octicon-repo-forked"></i> ', this.forks, '</span>',
    '<span class="language ', this.language, '">', this.language, '</span>',
    '</div>',
    '<p class="repo-description">', this.description, '</p>',
    '</div>'
  ].join('');
}

Repository.prototype.bottomLinks = function () {
  if (this.blogPost() || this.onlineWebsite() || this.android()) {
    return [
      '<div class="island-item bottom-links">',
      this.getBlogLink(),
      this.getWebsiteLink(),
	  this.getAndroidLink(),
      '</div>'
    ].join('');
  }
}
// ********************************

// *** loader *********************
var repos_completed_count = 2;
var repos_loaded_count = 0;
var repos_loaded_completed = false;

function getGithubData(url, local_file_path, loadRepositoryData, loadRepositoryDataFromJson) {
  $.ajax({
    url: url,
    async: true,
    success: function (data, textStatus, xhr) {
      if (data.length > 0) {
        loadRepositoryData(data);
      }
      else {
        console.log('call ' + url + ' failed: ' + xhr);
        loadRepositoryDataFromJson(local_file_path, loadRepositoryData);
      }
    },
    error: function (data, textStatus, xhr) {
      console.log('call ' + url + ' failed: ' + xhr);
      loadRepositoryDataFromJson(local_file_path, loadRepositoryData);
    },
    timeout: 10000 //in milliseconds
  });

}

function loadRepositoryDataFromJson(local_file_path, loadRepositoryData) {

  $.ajax({
    url: local_file_path,
    async: true,
    success: function (data, textStatus, xhr) {
      if (data.length > 0) {
        loadRepositoryData(data);
      }
      else {
        console.log('load ' + local_file_path + ' failed: ' + xhr);
        load_count++;
      }
    },
    timeout: 10000 //in milliseconds
  });

};

function loadRepositoryData(repoData) {

  repoData.forEach(function (repoDatum) {
    org.repos.push(new Repository(repoDatum));
  });

  repos_loaded_count++;
}

var org = new Organization('zmcx16');
org.repos = [];
var load_repos_timeId=0;

function loadAllRepositoryData() {

  if( repos_loaded_count >= repos_completed_count){
    
    org.addReposToContainer($('.projects .featured'), org.featuredRepos());
    // org.addReposToContainer($('.projects .not-featured .AI_ML'), org.regularRepos('AI_ML'));
    // org.addReposToContainer($('.projects .not-featured .Trade'), org.regularRepos('Trade'));
    // org.addReposToContainer($('.projects .not-featured .Application_Framework'), org.regularRepos('Application_Framework'));

    repos_loaded_completed = true;
    clearInterval(load_repos_timeId);
  }
}

$(document).ready(function () {

  loadRepositoryDataFromJson('zmcx16_virtual_repos.json', loadRepositoryData);
  getGithubData('https://api.github.com/users/zmcx16/repos?per_page=100', 'zmcx16_repos.json', loadRepositoryData, loadRepositoryDataFromJson);
  // getGithubData('https://api.github.com/users/zmcx16/starred?per_page=100', 'zmcx16_starred.json', loadRepositoryData, loadRepositoryDataFromJson);

  load_repos_timeId = setInterval(function () { loadAllRepositoryData() }, 100);
});
// ********************************

// *** opensource-site ************
function doClickIsland(){
  if ($(this).attr('class').indexOf("bottom-links") > -1) { return }
  console.log($(this));
  var target = $(this).parent().find('h3 a');
  if (target[0].outerHTML.indexOf('onclick') >= 0) {
    target[0].onclick();
  } else {
    window.open(target.attr('vhref'), '_blank');
  }
}

$(document).ready(function () {
  $('.titled-subnav a').click(function (e) {
    e.preventDefault();

    $('.titled-subnav a').removeClass('active');
    $('.projects').hide();
    $(e.target).addClass('active');

    var container = ".projects." + $(e.target).data('container');
    $(container).show();
  });

  $('body').on('click', '.project .island-item.featured-image', doClickIsland);
  $('body').on('click', '.project .island-item.content', doClickIsland);

  $('body').on('mouseover', '.project', function () {
    if ($(this).attr('msg')){
      $('.message')[0].innerText = $(this).attr('msg');
      $('.message').css('opacity', 1);
    }
  });

  $('body').on('mouseleave', '.project', function () {
    $('.message').css('opacity', 0);
  });

});
// ********************************
